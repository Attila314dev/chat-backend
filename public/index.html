<!doctype html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<title>Simple Chat</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root { --gap:.75rem; --rad:.8rem; }

body{font-family:system-ui,sans-serif;max-width:640px;margin:0 auto;padding:var(--gap);}
h1{text-align:center}

.text-input{width:260px;height:42px;padding:6px 10px;font:18px monospace;border:2px solid #888;
            border-radius:var(--rad);}
.text-input:focus{border-color:#000;outline:none}

.card{border:1px solid #ccc;border-radius:var(--rad);padding:var(--gap);
      display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--gap);}
.card small{font-size:.8rem;color:#666;}
#roomList .card:hover{background:#f6f6f6;cursor:pointer}

.btn{padding:.4rem .9rem;margin:.15rem;border:1px solid #888;border-radius:var(--rad);background:#fafafa;cursor:pointer}
.hidden{display:none}

#createForm{background:#fff;padding:1rem;border:1px solid #ccc;border-radius:var(--rad);
            width:280px;margin:1rem auto;box-shadow:0 4px 10px rgba(0,0,0,.15);}

#messages{height:50vh;border:1px solid #ddd;border-radius:var(--rad);padding:.3rem var(--gap);
          overflow-y:auto;margin-bottom:var(--gap);user-select:none;font:16px/1.3 monospace;}

.msg      {display:flex;flex-direction:row;width:100%;margin-bottom:.6rem;}
.msg .timer{width:3.5ch;color:#888;margin-right:.4ch;flex-shrink:0;user-select:none;}
.msg .text {width:30ch;white-space:pre-wrap;overflow-wrap:break-word;opacity:1;
            transition:opacity 300s linear;}          /* fokozatos halványítás */
</style>
</head>
<body>
<h1>Simple Chat</h1>

<!-- csak a chat-panelt változtattuk; a landing, create, join kód változatlan → ... -->

<div id="chat" class="hidden">
  <button class="btn" id="backBtn">← Back</button>
  <h3>Room <span id="roomLbl"></span></h3>
  <div style="display:flex;gap:var(--gap);">
    <div style="flex:3;">
      <div id="messages"></div>
      <input id="msgInput" class="text-input" placeholder="Message" style="width:70%;">
      <button class="btn" id="sendBtn">Send</button>
    </div>
    <div id="side" style="flex:1;">
      <strong>Users</strong>
      <ul id="userList"></ul>
    </div>
  </div>
</div>

<script>
/* -------------- csak az üzenet-megjelenítés logikája új -------------- */
const $=id=>document.getElementById(id);
let ws,roomId,userId;

/* ... (a landing-, join-, create-, websocket-kód változatlan) ... */

/* üzenet felvétele */
function addMsg(m,live){
  const wrap   = document.createElement('div'); wrap.className='msg';
  const timer  = document.createElement('span'); timer.className='timer';
  const text   = document.createElement('span'); text.className='text';

  text.textContent = `[${new Date(m.sentAt).toLocaleTimeString()}] ${m.username}: ${m.content}`;

  const remain = Math.max(0, 300 - Math.floor((Date.now() - m.sentAt)/1000));
  timer.textContent = remain.toString().padStart(3,'0');

  wrap.append(timer,text);
  $("messages").appendChild(wrap);
  $("messages").scrollTop = $("messages").scrollHeight;

  /* visszaszámláló frissítés */
  const iv = setInterval(()=>{
    let left = parseInt(timer.textContent,10)-1;
    if(left<=0){clearInterval(iv); left=0;}
    timer.textContent = left.toString().padStart(3,'0');
  },1000);

  /* halványítás csak a .text-re */
  text.style.opacity = live ? '1' : String( (remain/300).toFixed(2) );
  if(live) setTimeout(()=>text.style.opacity='0.2',300000);

  /* kijelölés → törlés */
  text.addEventListener('mouseup',()=>{ if(getSelection().toString()) wrap.remove(); });
}

/* tiltjuk a másolást a messages konténerből */
$("messages").addEventListener('copy',e=>e.preventDefault());

/* Enter = Send */
$("sendBtn").onclick=send;
$("msgInput").addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();send();}});
function send(){ const t=$("msgInput").value.trim();
  if(t){ ws?.send(JSON.stringify({type:'message',content:t})); $("msgInput").value=''; } }
</script>
</body>
</html>
